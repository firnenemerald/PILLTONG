# PilltongApp - 약물 관리 앱 업데이트

## 새로운 기능

### 1. 향상된 시간 선택 기능

#### 기존 문제점
- "Once a day"와 "Twice a day" 옵션 선택 시 시간을 설정할 수 없었음
- 오직 "Custom times" 옵션에서만 시간 선택 가능했음

#### 해결된 기능
- **"Once a day" 선택 시**: 기본 시간(오전 9시)이 설정되며, 사용자가 원하는 시간으로 변경 가능
- **"Twice a day" 선택 시**: 기본 시간(오전 9시, 오후 9시)이 설정되며, 각각 개별적으로 시간 변경 가능
- **"3 times a day" 선택 시**: 기본 시간 자동 설정 (오전 8시, 오후 2시, 오후 8시)
- **"Custom times" 선택 시**: 기존과 동일하게 원하는 만큼 시간 추가 가능

### 2. 실제 알림 시스템 구현

#### 새로운 알림 기능
- **자동 알림 스케줄링**: 약물 추가/수정 시 자동으로 알림이 설정됩니다
- **실시간 알림**: 설정된 시간에 정확히 알림이 발생합니다
- **매일 반복**: 알림은 매일 같은 시간에 반복됩니다
- **백그라운드 작동**: 앱이 꺼져있어도 알림이 정상 작동합니다

#### 알림 관리 기능
- **개별 알림 토글**: 약물 리스트에서 각 약물의 알림을 개별적으로 켜거나 끌 수 있습니다
- **알림 설정 화면**: 설정 탭에서 "알림 관리"를 통해 전체 알림을 관리할 수 있습니다
- **자동 정리**: 약물 삭제 시 해당 약물의 모든 알림이 자동으로 취소됩니다

## 기술적 개선사항

### 1. 데이터 모델 확장
```dart
class Medication {
  final String name;
  final String dosage;
  final String frequency;
  final List<String>? customNotificationTimes; // 커스텀 시간
  final List<String>? scheduledTimes; // 고정 빈도용 스케줄 시간
  final bool notificationsEnabled; // 알림 활성화 여부
}
```

### 2. 새로운 서비스 클래스

#### NotificationService 강화
- `scheduleMedicationNotifications()`: 약물별 다중 알림 스케줄링
- `cancelMedicationNotifications()`: 약물별 알림 일괄 취소
- 고유 ID 기반 알림 관리로 충돌 방지

#### MedicationService 신규 추가
- `deleteMedication()`: 약물 삭제와 동시에 알림 취소
- `toggleNotification()`: 개별 약물 알림 토글
- `rescheduleAllNotifications()`: 전체 알림 재설정

### 3. UI/UX 개선

#### 약물 추가/수정 화면
- 빈도 선택에 따른 동적 UI 변경
- 시간 선택 카드 UI 추가
- 직관적인 시간 설정 인터페이스

#### 홈 화면 개선
- 다음 복용 시간까지의 시간 표시
- 시각적으로 개선된 약물 카드 디자인

#### 약물 리스트 화면
- 알림 토글 스위치 추가
- 삭제 시 확인 대화상자
- 알림 상태 실시간 반영

#### 새로운 알림 설정 화면
- 전체 알림 재설정 기능
- 모든 알림 취소 기능  
- 알림 관련 정보 제공

## 사용 방법

### 약물 추가 시 시간 설정
1. 약물 정보 입력 (이름, 용량)
2. 복용 빈도 선택:
   - **Once a day**: 기본 시간(09:00) 표시, 탭하여 변경 가능
   - **Twice a day**: 기본 시간(09:00, 21:00) 표시, 각각 개별 변경 가능
   - **3 times a day**: 기본 시간 자동 설정
   - **Custom times**: 원하는 만큼 시간 추가
3. 저장하면 자동으로 알림 설정

### 알림 관리
1. **개별 약물 알림 토글**: 약물 리스트에서 스위치 사용
2. **전체 알림 관리**: 설정 > 알림 관리
3. **알림 문제 해결**: 알림 설정 화면에서 "모든 알림 다시 설정" 사용

### 약물 수정
1. 홈 화면 또는 약물 리스트에서 약물 카드 터치
2. 정보 수정 및 시간 조정
3. 저장하면 알림이 자동으로 업데이트

## 주의사항

### 알림 권한
- 앱 설치 후 첫 실행 시 알림 권한을 허용해야 합니다
- 시스템 설정에서 앱 알림이 차단되면 알림이 표시되지 않습니다

### 배터리 최적화
- 일부 Android 기기에서는 배터리 최적화 설정으로 인해 알림이 지연될 수 있습니다
- 설정 > 배터리 > 배터리 최적화에서 앱을 제외하는 것을 권장합니다

### 시간대 변경
- 시간대가 변경되면 "알림 관리"에서 "모든 알림 다시 설정"을 실행하세요

## 앞으로 추가될 기능 (예정)

- [ ] 복용 완료 체크 기능
- [ ] 복용 기록 통계
- [ ] 약물 상호작용 경고
- [ ] 약국 위치 찾기
- [ ] 약물 재고 관리
- [ ] 의사 처방 기록 연동

## 기술 스택

- **Flutter**: 크로스 플랫폼 앱 개발
- **Firebase**: 백엔드 서비스 (인증, 데이터베이스)
- **Flutter Local Notifications**: 로컬 알림 처리
- **Timezone**: 시간대 관리
- **Google ML Kit**: 처방전 텍스트 인식

## 문제 해결

### 알림이 작동하지 않는 경우
1. 앱 알림 권한 확인
2. 배터리 최적화 설정 확인
3. "알림 관리"에서 "모든 알림 다시 설정" 실행

### 시간 설정이 저장되지 않는 경우
1. 인터넷 연결 확인
2. 앱 재시작
3. Firebase 연결 상태 확인

### 앱이 느린 경우
1. 저장공간 확인
2. 앱 캐시 삭제
3. 앱 재설치 고려
